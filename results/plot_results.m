%% Import data from text file.
% Script for importing data from the following text file:
%
%    /home/angel/Proyectos/robc_webots/simulation_results-1561047479.csv
%
% To extend the code to different selected data or a different text file,
% generate a function instead of a script.

% Auto-generated by MATLAB on 2019/06/20 19:31:21

%% Initialize variables.



name = [
"/results/simulation_results-1561115740.csv";
"/home/angel/Proyectos/robc_webots/results/simulation_results-1561128081.csv";
"/home/angel/Proyectos/robc_webots/results/simulation_results-1561136705.csv";
"/home/angel/Proyectos/robc_webots/results/simulation_results-1561143931.csv";
"/home/angel/Proyectos/robc_webots/results/simulation_results-1561151035.csv";
"/home/angel/Proyectos/robc_webots/results/simulation_results-1561157794.csv";
"/home/angel/Proyectos/robc_webots/results/simulation_results-1561163945.csv";
"/home/angel/Proyectos/robc_webots/results/simulation_results-1561171334.csv";
"/home/angel/Proyectos/robc_webots/results/simulation_results-1561187995.csv";
"/home/angel/Proyectos/robc_webots/results/simulation_results-1561211893.csv";
"/home/angel/Proyectos/robc_webots/results/simulation_results-1561228864.csv";
"/home/angel/Proyectos/robc_webots/results/simulation_results-1561246646.csv"]

filelist = dir('robc_webots/results/*.csv')

%% Format for each line of text:

delimiter = ',';
startRow = 2;


%   column1: double (%f)
%	column2: double (%f)
%   column3: double (%f)
%	column4: double (%f)
%   column5: double (%f)
%	column6: double (%f)
%   column7: double (%f)
% For more information, see the TEXTSCAN documentation.
formatSpec = '%f%f%f%f%f%f%f%f%f%[^\n\r]';

for i = 1:length(filelist)
    %%Open the text file.
    filename = strcat( filelist(i).folder,'/'  ,filelist(i).name);
    fileID = fopen(filename,'r');

    % Read columns of data according to the format.
    dataArray = textscan(fileID, formatSpec, 'Delimiter', delimiter, 'TextType', 'string', 'HeaderLines' ,startRow-1, 'ReturnOnError', false, 'EndOfLine', '\r\n');

    % Close the text file.
    fclose(fileID);

    %Create output variable
    simulationresults{i} = table(dataArray{1:end-1}, 'VariableNames', {'timestamp','Kp','Ki','Sa','Sb','Bp','distance','bestdist','simres'});
end

%% Clear temporary variables
clearvars filename delimiter startRow formatSpec fileID dataArray ans;

%% Select best results

j = 1;
for i = 1:length(filelist)
    mbest = max(simulationresults{i}.bestdist);
    bdistance(i) = mbest;
    fprintf("Distance: %f\n", mbest)
    if mbest > 2000
        bestresults{j} = simulationresults{i};
        j = j + 1;
    end
end
numbests = j -1;
close all
figure(1)
plot(bdistance,'o')
ylabel('Mejor distancia')
xlabel('Número de simulación')
grid on
%% PLot 


    
close all
for i = 1:numbests
    
    res = bestresults{5};
    
    figure(1)
    subplot(3,2,1)
    plot(res.simres .* res.Kp ,'.')
    hold on
    title('kp')
    grid on
    
    subplot(3,2,2)
    plot(res.simres .* res.Ki ,'.')
    hold on
    title('ki')
    grid on
   
    subplot(3,2,3)
    plot(res.simres .* res.Sa ,'.')
    hold on
    title('Sa')
    grid on
    
    subplot(3,2,4)
    plot(res.simres .* res.Sb ,'.')
    hold on
    title('Sb')
    grid on
    
    subplot(3,2,5)
    plot(res.simres .* res.Bp ,'.')
    hold on
    title('Bp')
    grid on

    figure(2)
    plot(res.distance, '.' )
    hold on
    figure(3)
    plot(res.bestdist, '.' )
    hold on
end

%% Plot Histogram

close all    
res = bestresults{5};
    
    figure(1)
    subplot(3,2,1)
    plot(res.Kp ,'.')
    hold on
    title('kp')
    grid on
    
    subplot(3,2,2)
    plot(res.Ki ,'.')
    hold on
    title('ki')
    grid on
   
    subplot(3,2,3)
    plot(res.Sa ,'.')
    hold on
    title('Sa')
    grid on
    
    subplot(3,2,4)
    plot(res.Sb ,'.')
    hold on
    title('Sb')
    grid on
    
    subplot(3,2,5)
    plot(res.Bp ,'.')
    hold on
    title('Bp')
    grid on

    figure(2)
    plot(res.distance, '.' )
    hold on
    figure(3)
    plot(res.bestdist, '.' )
    hold on
